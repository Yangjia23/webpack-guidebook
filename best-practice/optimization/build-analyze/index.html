<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/webpack-guidebook/umi.css" />
    <script>
      window.routerBase = "/webpack-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.20
    </script>
    <title>构建分析</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/webpack-guidebook-favicon.svg&#x27;)" href="/webpack-guidebook//">Webpack Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/webpack-guidebook//basic-summary">基本综述</a><a href="/webpack-guidebook//principle-analysis">原理分析</a><a aria-current="page" class="active" href="/webpack-guidebook//best-practice">最佳实践</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/webpack-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/webpack-guidebook-favicon.svg&#x27;)" href="/webpack-guidebook//"></a><h1>Webpack Guidebook</h1><p>Webpack 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/webpack-guidebook//basic-summary">基本综述</a></li><li><a href="/webpack-guidebook//principle-analysis">原理分析</a></li><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice">最佳实践</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/webpack-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/webpack-guidebook//best-practice/practical-application">实战应用</a><ul><li><a href="/webpack-guidebook//best-practice/practical-application/composing-webpack-configuration"><span>组合配置</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-style"><span>加载样式</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-images"><span>加载图片</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-fonts"><span>加载字体</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-javascript"><span>加载脚本</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/environment-variables"><span>环境变量</span></a></li></ul></li><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice/optimization">构建优化</a><ul><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice/optimization/build-analyze"><span>构建分析</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/multi-process"><span>多进程/多线程优化</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/precompile"><span>预编译资源模块</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/build-cache-strategy"><span>构建缓存策略</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/exclude-build-target"><span>缩小构建目标</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/bundle-spliting"><span>分割打包 Bundle Spliting</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/code-splitting"><span>代码拆分 Code Spliting</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/minifying"><span>压缩代码</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/dynamic-polyfill"><span>动态 Ployfill</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/collection"><span>构建优化总结</span></a></li></ul></li><li><a href="/webpack-guidebook//best-practice/extensions">扩展资料</a><ul><li><a href="/webpack-guidebook//best-practice/extensions/overview"><span>扩展资料</span></a></li><li><a href="/webpack-guidebook//best-practice/extensions/loaders"><span>加载器合集</span></a></li><li><a href="/webpack-guidebook//best-practice/extensions/plugins"><span>插件合集</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="内置统计分析" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/optimization/build-analyze#内置统计分析"><span>内置统计分析</span></a></li><li title="速度分析" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/optimization/build-analyze#速度分析"><span>速度分析</span></a></li><li title="体积分析" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/optimization/build-analyze#体积分析"><span>体积分析</span></a></li><li title="速度优化策略" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/optimization/build-analyze#速度优化策略"><span>速度优化策略</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="构建分析"><a aria-hidden="true" href="#构建分析"><span class="icon icon-link"></span></a>构建分析</h1><h2 id="内置统计分析"><a aria-hidden="true" href="#内置统计分析"><span class="icon icon-link"></span></a>内置统计分析</h2><p>如果你不希望使用 <code>quiet</code> 或 <code>noInfo</code> 这样的不显示信息，而是又不想得到全部的信息，只是想要获取某部分 <code>bundle</code> 的信息，使用 <code>stats</code> 选项是比较好的折衷方式。</p><p>有一些预设选项，可作为快捷方式。像这样使用它们：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="stats: &#x27;errors-only&#x27;;
" data-status="copy"></button><div class="token-line"><span class="token plain">stats</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;errors-only&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><table><thead><tr><th>Preset</th><th>Alternative</th><th>Description</th></tr></thead><tbody><tr><td><code>&quot;errors-only&quot;</code></td><td><code>none</code></td><td>只有发生错误时输出</td></tr><tr><td><code>&quot;minimal&quot;</code></td><td><code>none</code></td><td>只在发生错误或有新的编译时输出</td></tr><tr><td><code>&quot;none&quot;</code></td><td><code>false</code></td><td>没有输出</td></tr><tr><td><code>&quot;normal&quot;</code></td><td><code>true</code></td><td>标准输出</td></tr><tr><td><code>&quot;verbose&quot;</code></td><td><code>none</code></td><td>全部数据</td></tr></tbody></table><p>在 package.json 中使用 stats</p><div class="__dumi-default-code-block"><pre class="prism-code language-json"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="{
  &quot;scripts&quot;: {
    &quot;build:stats&quot;: &quot;webpack --env production --json &gt; stats.json&quot;
  }
}
" data-status="copy"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;build:stats&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;webpack --env production --json &gt; stats.json&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>缺点：颗粒度太粗，看不出问题所在。</p><p>更多的选项配置：<a href="https://www.webpackjs.com/configuration/stats/#stats" target="_blank" rel="noopener noreferrer">Webpack 统计信息<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="速度分析"><a aria-hidden="true" href="#速度分析"><span class="icon icon-link"></span></a>速度分析</h2><p>对 Webpack 构建速度进行优化的首要任务就是去知道哪些地方值得我们注意。</p><p><a href="https://github.com/stephencookdev/speed-measure-webpack-plugin" target="_blank" rel="noopener noreferrer">speed-measure-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 插件能够测量 Webpack 构建速度，并给出测量报告的输出：</p><p><img src="/webpack-guidebook/static/speed-measure-webpack-plugin.5930857c.png"/></p><p>从输出报告可以看到每个 loader 和 plugin 的执行耗时。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const SpeedMeasurePlugin = require(&#x27;speed-measure-webpack-plugin&#x27;);

const smp = new SppedMeasurePlugin();

const webpackConfig = smp.wrap({
  plugins: [
    new MyPlugin(),
    new MyOtherPlugin().,
  ]
})
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">SpeedMeasurePlugin</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;speed-measure-webpack-plugin&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> smp </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">SppedMeasurePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> webpackConfig </span><span class="token operator">=</span><span class="token plain"> smp</span><span class="token punctuation">.</span><span class="token method function property-access">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  plugins</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">MyOtherPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>速度分析插件作用：</p><ul><li>分析整个打包总耗时</li><li>每个 loader 和 plugin 的耗时情况</li></ul><h2 id="体积分析"><a aria-hidden="true" href="#体积分析"><span class="icon icon-link"></span></a>体积分析</h2><p>通过 <a href="https://github.com/webpack-contrib/webpack-bundle-analyzer" target="_blank" rel="noopener noreferrer">webpack-bundle-analyzer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 插件能够在 Webpack 构建结束后生成构建产物体积报告，配合可视化的页面，能够直观知道产物中的具体占用体积。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const BundleAnalyzerPlugin = require(&#x27;webpack-bundle-analyzer&#x27;).BundleAnalyzerPlugin;

module.exports = {
  plugins: [new BundleAnalyzerPlugin()],
};
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">BundleAnalyzerPlugin</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;webpack-bundle-analyzer&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BundleAnalyzerPlugin</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  plugins</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>插件生成的最终效果图如下：</p></div><img alt="webpack-bundle-analyzer效果图" src="/webpack-guidebook/static/webpack-bundle-analyzer-report.a6ef627c.png" width="720"/><div class="markdown"><p>这个插件做的工作本质就是分析在 <code>compiler.plugin(&#x27;done&#x27;, function(stats))</code> 时传入的参数。<a href="https://github.com/webpack/webpack/blob/webpack-4/lib/Stats.js#L29" target="_blank" rel="noopener noreferrer">Stats<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是 Webpack 的一个统计类。传入的实例如下图：</p><p><strong>stats</strong></p></div><img alt="webpack-bundle-analyzer-stats" src="/webpack-guidebook/static/webpack-bundle-analyzer-stats.d3a3b870.png" width="720"/><div class="markdown"><p><strong>compilation</strong></p></div><img alt="webpack-bundle-analyzer-compilation" src="/webpack-guidebook/static/webpack-bundle-analyzer-compilation.6514fe7b.png" width="720"/><div class="markdown"><p>对 Stats 实例调用 <code>toJSON()</code> 方法，获取格式化信息。</p><p>这个插件就是从 <code>stats.json</code> 中获取 <code>chunks</code> 然后最终使用 Canvas 画图。具体代码位于 analyzer.js 中的 <a href="https://github.com/webpack-contrib/webpack-bundle-analyzer/blob/master/src/analyzer.js#L20" target="_blank" rel="noopener noreferrer">getViewerData<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法。</p><h2 id="速度优化策略"><a aria-hidden="true" href="#速度优化策略"><span class="icon icon-link"></span></a>速度优化策略</h2><p>使用高版本的 webpack 和 Node.js</p><p>使用 webpack4</p><ul><li>V8 带来的优化（for of 替代 forEach、Map 和 Set 替代 Object、includes 替代 indexOf）</li><li>默认使用更快的 md4 hash 算法</li><li>webpack AST 可以直接从 loader 传递给 AST，减少解析时间</li><li>使用字符串方法替代正则表达式</li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/Webpack-Guidebook/edit/master/docs/best-practice/optimization/build-analyze.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/18/2020, 10:19:07 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/webpack-guidebook/umi.js"></script>
    <script src="/webpack-guidebook/docs__best-practice__optimization__build-analyze.md.js"></script>
  </body>
</html>
