<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/webpack-guidebook/umi.css" />
    <script>
      window.routerBase = "/webpack-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.20
    </script>
    <title>环境变量</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/webpack-guidebook-favicon.svg&#x27;)" href="/webpack-guidebook//">Webpack Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/webpack-guidebook//basic-summary">基本综述</a><a href="/webpack-guidebook//principle-analysis">原理分析</a><a aria-current="page" class="active" href="/webpack-guidebook//best-practice">最佳实践</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/webpack-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/webpack-guidebook-favicon.svg&#x27;)" href="/webpack-guidebook//"></a><h1>Webpack Guidebook</h1><p>Webpack 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/webpack-guidebook//basic-summary">基本综述</a></li><li><a href="/webpack-guidebook//principle-analysis">原理分析</a></li><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice">最佳实践</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/webpack-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice/practical-application">实战应用</a><ul><li><a href="/webpack-guidebook//best-practice/practical-application/composing-webpack-configuration"><span>组合配置</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-style"><span>加载样式</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-images"><span>加载图片</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-fonts"><span>加载字体</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-javascript"><span>加载脚本</span></a></li><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice/practical-application/environment-variables"><span>环境变量</span></a></li></ul></li><li><a href="/webpack-guidebook//best-practice/optimization">构建优化</a><ul><li><a href="/webpack-guidebook//best-practice/optimization/build-analyze"><span>构建分析</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/multi-process"><span>多进程/多线程优化</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/precompile"><span>预编译资源模块</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/build-cache-strategy"><span>构建缓存策略</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/exclude-build-target"><span>缩小构建目标</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/bundle-spliting"><span>分割打包 Bundle Spliting</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/code-splitting"><span>代码拆分 Code Spliting</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/minifying"><span>压缩代码</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/dynamic-polyfill"><span>动态 Ployfill</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/collection"><span>构建优化总结</span></a></li></ul></li><li><a href="/webpack-guidebook//best-practice/extensions">扩展资料</a><ul><li><a href="/webpack-guidebook//best-practice/extensions/overview"><span>扩展资料</span></a></li><li><a href="/webpack-guidebook//best-practice/extensions/loaders"><span>加载器合集</span></a></li><li><a href="/webpack-guidebook//best-practice/extensions/plugins"><span>插件合集</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="DefinePlugin 的基本思想" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/practical-application/environment-variables#defineplugin-的基本思想"><span>DefinePlugin 的基本思想</span></a></li><li title="process.env.NODE_ENV" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/practical-application/environment-variables#processenvnode_env"><span>process.env.NODE_ENV</span></a></li><li title="通过 Babel 替换自由变量" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/practical-application/environment-variables#通过-babel-替换自由变量"><span>通过 Babel 替换自由变量</span></a></li><li title="选择要使用的模块" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/practical-application/environment-variables#选择要使用的模块"><span>选择要使用的模块</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="环境变量"><a aria-hidden="true" href="#环境变量"><span class="icon icon-link"></span></a>环境变量</h1><p>有时，部分代码应仅在开发期间执行，或者有一些实验性质的代码不适宜放在生产环境中。控制 <strong>环境变量</strong> 变得很有价值，因为您可以使用它们切换功能。</p><p>由于 JavaScript 压缩会删除一些不需要的代码，因此您可以按照这样的形式来编写自己的代码。Webpack DefinePlugin 可以自由替换环境变量，以便您可以根据环境变量将 <code>if (process.env.NODE_ENV === &quot;development&quot;)</code> 类型的代码转换为 <code>if (true)</code> 或 <code>if (false)</code>。</p><p>您可以找到依赖此行为的包。React 可能是早期采用该技术的最著名的例子。因此，使用 DefinePlugin 可以在某种程度上降低 React 生产构建的大小，并且您可以看到其他软件包也具备类似的效果。</p><p>Webpack 4 基于给定模式设置 <code>process.env.NODE_ENV</code>。不过，了解它并知道其工作方式还是非常必要的。</p><h2 id="defineplugin-的基本思想"><a aria-hidden="true" href="#defineplugin-的基本思想"><span class="icon icon-link"></span></a>DefinePlugin 的基本思想</h2><p>要更好地理解 DefinePlugin 的基本思想，请考虑以下示例：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="var foo;

// 依赖于上面 foo 变量，不能够随意替换
if (foo === &#x27;bar&#x27;) {
  console.log(&#x27;bar&#x27;);
}

// 可以自由替换，因为上文不存在 bar 变量
if (bar === &#x27;bar&#x27;) {
  console.log(&#x27;bar&#x27;);
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">var</span><span class="token plain"> foo</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 依赖于上面 foo 变量，不能够随意替换</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">foo </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 可以自由替换，因为上文不存在 bar 变量</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">bar </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>如果你用类似 <code>&quot;foobar&quot;</code> 的字符串替换 <code>bar</code>，那么你最终会得到如下代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="var foo;

// 依赖于上面 foo 变量，不能够随意替换
if (foo === &#x27;bar&#x27;) {
  console.log(&#x27;bar&#x27;);
}

// 可以自由替换，因为上文不存在 bar 变量
if (&#x27;foobar&#x27; === &#x27;bar&#x27;) {
  console.log(&#x27;bar&#x27;);
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">var</span><span class="token plain"> foo</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 依赖于上面 foo 变量，不能够随意替换</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">foo </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 可以自由替换，因为上文不存在 bar 变量</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token string">&#x27;foobar&#x27;</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>进一步的分析显示，<code>&quot;foobar&quot; === &quot;bar&quot;</code> 等于 <code>false</code> 压缩器会得到以下内容：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="var foo;

// 依赖于上面 foo 变量，不能够随意替换
if (foo === &#x27;bar&#x27;) {
  console.log(&#x27;bar&#x27;);
}

// 可以自由替换，因为上文不存在 bar 变量
if (false) {
  console.log(&#x27;bar&#x27;);
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">var</span><span class="token plain"> foo</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 依赖于上面 foo 变量，不能够随意替换</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">foo </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 可以自由替换，因为上文不存在 bar 变量</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>接着，压缩器消除了 <code>if</code> 语句，因为它们永远都不会被执行：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="var foo;

// 依赖于上面 foo 变量，不能够随意替换
if (foo === &#x27;bar&#x27;) {
  console.log(&#x27;bar&#x27;);
}

// if (false) 意味整个块都会被移除
" data-status="copy"></button><div class="token-line"><span class="token keyword">var</span><span class="token plain"> foo</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 依赖于上面 foo 变量，不能够随意替换</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">foo </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// if (false) 意味整个块都会被移除</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>消除是 DefinePlugin 的核心思想，它允许不同的切换。压缩器执行分析并切换代码的 ​​ 整个部分。</p><h2 id="processenvnode_env"><a aria-hidden="true" href="#processenvnode_env"><span class="icon icon-link"></span></a>process.env.NODE_ENV</h2><p>和以前一样，将这个想法封装成一个函数。由于 Webpack 替换自由变量的方式，你应该用 <code>JSON.stringify</code> 对变量进行转化，最终得到一个像 <code>&#x27;&quot;demo&quot;&#x27;</code> 一样的字符串，然后 Webpack 将其插入到对应的字段中：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// webpack.parts.js
const webpack = require(&#x27;webpack&#x27;);

exports.setFreeVariable = (key, value) =&gt; {
  const env = {};
  env[key] = JSON.stringify(value);

  return {
    plugins: [new webpack.DefinePlugin(env)],
  };
};
" data-status="copy"></button><div class="token-line"><span class="token comment">// webpack.parts.js</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> webpack </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">setFreeVariable</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token parameter punctuation">,</span><span class="token parameter"> value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> env </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  env</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    plugins</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">webpack</span><span class="token class-name punctuation">.</span><span class="token class-name">DefinePlugin</span><span class="token punctuation">(</span><span class="token plain">env</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>将其合并到主配置上：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// webpack.config.js
const commonConfig = merge([parts.setFreeVariable(&#x27;Hello&#x27;, &#x27;hello from config&#x27;)]);
" data-status="copy"></button><div class="token-line"><span class="token comment">// webpack.config.js</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> commonConfig </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">parts</span><span class="token punctuation">.</span><span class="token method function property-access">setFreeVariable</span><span class="token punctuation">(</span><span class="token string">&#x27;Hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;hello from config&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><blockquote><p><a href="https://www.npmjs.com/package/webpack-conditional-loader" target="_blank" rel="noopener noreferrer">webpack-conditional-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 基于代码注释执行类似的操作，它可以用来消除整个代码块。</p></blockquote><blockquote><p><code>webpack.EnvironmentPlugin([&quot;NODE_ENV&quot;])</code> 是一种允许您引用环境变量的快捷方式。它在底层使用了 <code>DefinePlugin</code>，你可以通过传递 <code>process.env.NODE_ENV</code> 达到相同的效果。</p></blockquote><h2 id="通过-babel-替换自由变量"><a aria-hidden="true" href="#通过-babel-替换自由变量"><span class="icon icon-link"></span></a>通过 Babel 替换自由变量</h2><p><a href="https://www.npmjs.com/package/babel-plugin-transform-inline-environment-variables" target="_blank" rel="noopener noreferrer">babel-plugin-transform-inline-environment-variables<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可以实现这样的效果。<a href="https://www.npmjs.com/package/babel-plugin-transform-define" target="_blank" rel="noopener noreferrer">babel-plugin-transform-define<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://www.npmjs.com/package/babel-plugin-minify-replace" target="_blank" rel="noopener noreferrer">babel-plugin-minify-replace<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是 Babel 中的替代方案。</p><h2 id="选择要使用的模块"><a aria-hidden="true" href="#选择要使用的模块"><span class="icon icon-link"></span></a>选择要使用的模块</h2><p>本章中讨论的技术可用于根据环境变量选择整个模块。如上所示，DefinePlugin 基于拆分分支允许您选择要使用的代码以及要丢弃的代码。这个想法可用于在模块级别实现分支。考虑下面的文件结构：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text=".
└── store
    ├── index.js
    ├── store.dev.js
    └── store.prod.js
" data-status="copy"></button><div class="token-line"><span class="token builtin class-name">.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">└── store</span></div><div class="token-line"><span class="token plain">    ├── index.js</span></div><div class="token-line"><span class="token plain">    ├── store.dev.js</span></div><div class="token-line"><span class="token plain">    └── store.prod.js</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>我们的想法是根据环境变量来选择 <code>dev</code> 或 <code>prod</code> 版本。我们在 index.js 中来处理这部分工作：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="if (process.env.NODE_ENV === &#x27;production&#x27;) {
  module.exports = require(&#x27;./store.prod&#x27;);
} else {
  module.exports = require(&#x27;./store.dev&#x27;);
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;production&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./store.prod&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./store.dev&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>Webpack 可以根据 DefinePlugin 的声明来选择正确的代码。此处您必须使用 CommonJS 模块规范，因为 ES2015 <code>import</code> 不允许动态导入行为。</p><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://segmentfault.com/a/1190000017217915" target="_blank" rel="noopener noreferrer">实用 Webpack 插件之 DefinePlugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/Webpack-Guidebook/edit/master/docs/best-practice/practical-application/environment-variables.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/18/2020, 10:19:07 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/webpack-guidebook/umi.js"></script>
    <script src="/webpack-guidebook/docs__best-practice__practical-application__environment-variables.md.js"></script>
  </body>
</html>
