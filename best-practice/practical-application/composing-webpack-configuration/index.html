<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/webpack-guidebook/umi.css" />
    <script>
      window.routerBase = "/webpack-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.20
    </script>
    <title>组合配置</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/webpack-guidebook-favicon.svg&#x27;)" href="/webpack-guidebook//">Webpack Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/webpack-guidebook//basic-summary">基本综述</a><a href="/webpack-guidebook//principle-analysis">原理分析</a><a aria-current="page" class="active" href="/webpack-guidebook//best-practice">最佳实践</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/webpack-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/webpack-guidebook-favicon.svg&#x27;)" href="/webpack-guidebook//"></a><h1>Webpack Guidebook</h1><p>Webpack 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/webpack-guidebook//basic-summary">基本综述</a></li><li><a href="/webpack-guidebook//principle-analysis">原理分析</a></li><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice">最佳实践</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/webpack-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice/practical-application">实战应用</a><ul><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice/practical-application/composing-webpack-configuration"><span>组合配置</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-style"><span>加载样式</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-images"><span>加载图片</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-fonts"><span>加载字体</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-javascript"><span>加载脚本</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/environment-variables"><span>环境变量</span></a></li></ul></li><li><a href="/webpack-guidebook//best-practice/optimization">构建优化</a><ul><li><a href="/webpack-guidebook//best-practice/optimization/build-analyze"><span>构建分析</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/multi-process"><span>多进程/多线程优化</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/precompile"><span>预编译资源模块</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/build-cache-strategy"><span>构建缓存策略</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/exclude-build-target"><span>缩小构建目标</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/bundle-spliting"><span>分割打包 Bundle Spliting</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/code-splitting"><span>代码拆分 Code Spliting</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/minifying"><span>压缩代码</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/dynamic-polyfill"><span>动态 Ployfill</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/collection"><span>构建优化总结</span></a></li></ul></li><li><a href="/webpack-guidebook//best-practice/extensions">扩展资料</a><ul><li><a href="/webpack-guidebook//best-practice/extensions/overview"><span>扩展资料</span></a></li><li><a href="/webpack-guidebook//best-practice/extensions/loaders"><span>加载器合集</span></a></li><li><a href="/webpack-guidebook//best-practice/extensions/plugins"><span>插件合集</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="管理配置的方法" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/practical-application/composing-webpack-configuration#管理配置的方法"><span>管理配置的方法</span></a></li><li title="合并组合配置" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/practical-application/composing-webpack-configuration#合并组合配置"><span>合并组合配置</span></a></li><li title="组合配置的好处" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/practical-application/composing-webpack-configuration#组合配置的好处"><span>组合配置的好处</span></a></li><li title="配置布局" data-depth="2" class=""><a href="/webpack-guidebook//best-practice/practical-application/composing-webpack-configuration#配置布局"><span>配置布局</span></a></li><li title="按环境拆分配置" data-depth="3" class=""><a href="/webpack-guidebook//best-practice/practical-application/composing-webpack-configuration#按环境拆分配置"><span>按环境拆分配置</span></a></li><li title="按类别拆分配置" data-depth="3" class=""><a href="/webpack-guidebook//best-practice/practical-application/composing-webpack-configuration#按类别拆分配置"><span>按类别拆分配置</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="组合配置"><a aria-hidden="true" href="#组合配置"><span class="icon icon-link"></span></a>组合配置</h1><h2 id="管理配置的方法"><a aria-hidden="true" href="#管理配置的方法"><span class="icon icon-link"></span></a>管理配置的方法</h2><p>您可以通过以下方式管理 Webpack 配置：</p><ul><li>对于每一个环境都使用多个环境来组合配置，通过模块导入共享相同的配置，并通过 <code>--config</code> 参数将 Webpack 指向特定的环境</li><li>将配置打包成库，然后使用该库。例如：<a href="https://www.npmjs.com/package/hjs-webpack" target="_blank" rel="noopener noreferrer">hjs-webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://neutrino.js.org/" target="_blank" rel="noopener noreferrer">Neutrino<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://www.npmjs.com/package/webpack-blocks" target="_blank" rel="noopener noreferrer">webpack-blocks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>将配置转换成工具。例如：<a href="https://www.npmjs.com/package/create-react-app" target="_blank" rel="noopener noreferrer">create-raect-app<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://www.npmjs.com/package/kyt" target="_blank" rel="noopener noreferrer">kyt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://www.npmjs.com/package/nwb" target="_blank" rel="noopener noreferrer">nwb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>在单个文件中的维护所有的配置，并在其内部进行分支，使用传入 <code>--env</code> 参数来确定分支走向</li></ul><p>可以组合这些方法以创建更高级别的配置，然后由更小的部分组成。然后可以将这些部分添加到库中，然后通过 npm 使用它，从而可以在多个项目中使用相同的配置。</p><h2 id="合并组合配置"><a aria-hidden="true" href="#合并组合配置"><span class="icon icon-link"></span></a>合并组合配置</h2><p>如果配置文件被分成不同的部分，则必须以某种方式再次组合它们。通常这意味着合并对象和数组。为了解决 Object.assign 和 Array.concat 存在的问题，我们可以使用 <a href="https://www.npmjs.org/package/webpack-merge" target="_blank" rel="noopener noreferrer">webpack-merge<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><p><code>webpack-merge</code> 做了两件事：拼接数组并合并对象，而不是简单的覆盖它们。以下示例详细显示了这种特性：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const merge = require(&#x27;webpack-merge&#x27;);

const result = merge({ a: [1], b: 5, c: 20 }, { a: [2], b: 10, c: 421 });

console.log(result);
// { a: [1, 2], b: 10, c: 20, d: 421 }
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> merge </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;webpack-merge&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> c</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"> c</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">421</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// { a: [1, 2], b: 10, c: 20, d: 421 }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>webpack-merge</code> 提供了许多可控的策略，使您能够控制每个字段的行为。它们允许您对于特定的字段进行追加，添加或替换内容。</p><blockquote><p>在组合修改 Webpack 配置的时候，<a href="https://www.npmjs.com/package/webpack-chain" target="_blank" rel="noopener noreferrer">webpack-chain<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 提供了一个清晰的 API 简化这一过程。</p></blockquote><h2 id="组合配置的好处"><a aria-hidden="true" href="#组合配置的好处"><span class="icon icon-link"></span></a>组合配置的好处</h2><p>配置拆分提供了更好的扩展性和复用性。你可以把通用型配置和特殊型配置提取成配置单元，把这些配置单元作为包在不同的项目之间复用。</p><p>您还可以将配置作为依赖项进行管理，而不是在多个项目中复制类似的配置。当您的配置升级或者问题修复时，您的所有项目都会同时受益。</p><p>每种方法都有其优点和缺点。基于组合的方法是一个很好的起点。就组合而言，每部分的代码量是有限的，很容易阅读。你还可以看看别人是怎么做的，从而找到一些更好的做法。</p><p>也许最大的问题在于，你需要知道自己在做什么，而且第一次配置可能会缺乏经验。但这就是一个软件工程问题，它不是 Webpack 所独有的。</p><p>您可以随时迭代优化配置单元或者找到更好的配置单元。通过传入配置对象而不是多个参数，您可以在不影响其 API 的情况下更改配置单元的行为，从而根据需要有效地公开配置单元的 API。</p><h2 id="配置布局"><a aria-hidden="true" href="#配置布局"><span class="icon icon-link"></span></a>配置布局</h2><p>我们把 Webpack 配置分为两个文件：<code>webpack.config.js</code> 和 <code>webpack.parts.js</code>。前者包含通用型的配置，后者包含一些特殊配置，这样我们可以更方便的管理我们的配置文件。</p><h3 id="按环境拆分配置"><a aria-hidden="true" href="#按环境拆分配置"><span class="icon icon-link"></span></a>按环境拆分配置</h3><p>如果您按环境拆分配置，最终可能会得到如下文件结构：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text=".
└── config
    ├── webpack.common.js
    ├── webpack.development.js
    ├── webpack.parts.js
    └── webpack.production.js
" data-status="copy"></button><div class="token-line"><span class="token builtin class-name">.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">└── config</span></div><div class="token-line"><span class="token plain">    ├── webpack.common.js</span></div><div class="token-line"><span class="token plain">    ├── webpack.development.js</span></div><div class="token-line"><span class="token plain">    ├── webpack.parts.js</span></div><div class="token-line"><span class="token plain">    └── webpack.production.js</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>在这种情况下，您将通过 Webpack <code>--config</code> 参数和 <code>module.exports = merge(common, config);</code> 来获得最终的配置环境。</p><h3 id="按类别拆分配置"><a aria-hidden="true" href="#按类别拆分配置"><span class="icon icon-link"></span></a>按类别拆分配置</h3><p>我们可以将特殊配置放到一个文件夹中，按照类别把 <code>webpack.parts.js</code> 拆分成一个个小的配置文件：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text=".
└── config
    ├── parts
    │   ├── devserver.js
    ...
    │   ├── index.js
    │   └── javascript.js
    └── ...
" data-status="copy"></button><div class="token-line"><span class="token builtin class-name">.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">└── config</span></div><div class="token-line"><span class="token plain">    ├── parts</span></div><div class="token-line"><span class="token plain">    │   ├── devserver.js</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">..</span><span class="token plain">.</span></div><div class="token-line"><span class="token plain">    │   ├── index.js</span></div><div class="token-line"><span class="token plain">    │   └── javascript.js</span></div><div class="token-line"><span class="token plain">    └── </span><span class="token punctuation">..</span><span class="token plain">.</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>这种安排可以更快地找到与特定类别相关的配置。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/Webpack-Guidebook/edit/master/docs/best-practice/practical-application/composing-webpack-configuration.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/18/2020, 10:19:07 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/webpack-guidebook/umi.js"></script>
    <script src="/webpack-guidebook/docs__best-practice__practical-application__composing-webpack-configuration.md.js"></script>
  </body>
</html>
